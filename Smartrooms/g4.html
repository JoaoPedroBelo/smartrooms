<!doctype html>
<html lang="en">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css">

    <title>Grupo 4</title>
</head>

<body style="background: rgb(243, 243, 243)">

    <div id="app">

        <header>
            <nav class="navbar navbar-expand-md navbar-dark fixed-top bg-dark">
                <a class="navbar-brand" href="#" style="font-weight: bold;">Distributed Systems 18/19</a>
                <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarCollapse">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarCollapse">
                    <ul class="navbar-nav mr-auto">
                        <li class="nav-item">
                            <a class="nav-link" href="./g1.html">Grupo 1</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="./g2.html">Grupo 2</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="./index.html">Grupo 3</a>
                        </li>
                        <li class="nav-item active">
                            <a class="nav-link" href="./g4.html">Grupo 4</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="./g5.html">Grupo 5</a>
                        </li>
                    </ul>
                </div>
            </nav>
        </header>

        <div class="container" style="margin-top: 80px">

            <nav>
                <ol class="breadcrumb bg-dark">
                    <li class="breadcrumb-item text-white">Grupo 4</li>
                </ol>
            </nav>

            <div class="row" v-if="loading">
                <div class="col-md-12 my-2">
                    <div class="alert alert-info">
                        <strong>Loading...</strong>
                    </div>
                </div>
            </div>

            <div class="row" v-if="error != ''">
                <div class="col-md-12 my-2">
                    <div class="alert alert-danger">
                        <strong>Error:</strong> {{ error }}
                    </div>
                </div>
            </div>

            <div class="row">

                <div class="col-md-4 my-2">
                    <div class="card h-100">
                        <div class="card-body text-center">
                            <p class="card-text">Number of spaces</p>
                            <h2 class="card-title">{{ number_of_spaces }}</h2>
                        </div>
                    </div>
                </div>

                <div class="col-md-4 my-2">
                    <div class="card h-100">
                        <div class="card-body text-center">
                            <p class="card-text">Number of cars parked</p>
                            <h2 class="card-title">{{ number_of_cars_parked }}</h2>
                        </div>
                    </div>
                </div>

                <div class="col-md-4 my-2">
                    <div class="card h-100">
                        <div class="card-body text-center">
                            <p class="card-text">Number of free spaces</p>
                            <h2 class="card-title">{{ number_of_free_spaces }}</h2>
                        </div>
                    </div>
                </div>

            </div>

            <div class="row">

                <div class="col-md-3 my-2">
                    <div class="card h-100">
                        <div class="card-body text-center">
                            <p class="card-text">Number of entries in the last hour</p>
                            <h2 class="card-title">{{ number_of_entries_in_the_last_hour }}</h2>
                        </div>
                    </div>
                </div>

                <div class="col-md-3 my-2">
                    <div class="card h-100">
                        <div class="card-body text-center">
                            <p class="card-text">Number of entries today</p>
                            <h2 class="card-title">{{ number_of_entries_today }}</h2>
                        </div>
                    </div>
                </div>

                <div class="col-md-3 my-2">
                    <div class="card h-100">
                        <div class="card-body text-center">
                            <p class="card-text">Number of exits in the last hour</p>
                            <h2 class="card-title">{{ number_of_exits_in_the_last_hour }}</h2>
                        </div>
                    </div>
                </div>

                <div class="col-md-3 my-2">
                    <div class="card h-100">
                        <div class="card-body text-center">
                            <p class="card-text">Number of exits today</p>
                            <h2 class="card-title">{{ number_of_exits_today }}</h2>
                        </div>
                    </div>
                </div>

            </div>

            <div class="row">

                <div class="col-md-4 my-2">
                    <div class="card h-100">
                        <div class="card-body text-center">
                            <p class="card-text">Average number of cars parked today</p>
                            <h2 class="card-title">{{ average_number_of_cars_parked_today }}</h2>
                        </div>
                    </div>
                </div>

                <div class="col-md-4 my-2">
                    <div class="card h-100">
                        <div class="card-body text-center">
                            <p class="card-text">Average number of free spaces today</p>
                            <h2 class="card-title">{{ average_number_of_free_spaces_today }}</h2>
                        </div>
                    </div>
                </div>

                <div class="col-md-4 my-2">
                    <div class="card h-100">
                        <div class="card-body text-center">
                            <p class="card-text">Busiest hours today</p>
                            <h2 class="card-title">{{ busiest_hours_today.join(', ') }}</h2>
                        </div>
                    </div>
                </div>

            </div>

            <div class="row my-3">

                <div class="col-md-12 my-2">
                    <div class="p-2 bg-white">
                        <canvas id="cars-parked-hourly-chart"></canvas>
                    </div>
                </div>

            </div>

        </div>

    </div>

    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.22.2/moment.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.3/Chart.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue@2.5.17/dist/vue.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script>

        const app = new Vue({
            el: '#app',
            data: {
                loading: false,
                average_number_of_cars_parked_today: null,
                average_number_of_free_spaces_today: null,
                busiest_hours_today: [],
                number_of_cars_parked: null,
                number_of_cars_parked_today_hourly: [],
                cars_parked_hourly_chart: null,
                number_of_entries_in_the_last_hour: null,
                number_of_entries_today: null,
                number_of_exits_in_the_last_hour: null,
                number_of_exits_today: null,
                number_of_free_spaces: null,
                number_of_spaces: null,
                error: ''
            },
            methods: {
                clearChartData(chart) {
                    chart.data = {
                        labels: [],
                        datasets: []
                    }
                    chart.update()
                },
                initCharts() {
                    /*----------------------------------------*/
                    /*  Cars Parked Hourly Chart
                    /*----------------------------------------*/
                    this.cars_parked_hourly_chart = new Chart('cars-parked-hourly-chart', {
                        type: 'bar',
                        options: {
                            scales: {
                                yAxes: [{
                                    scaleLabel: {
                                        display: true,
                                        labelString: 'Cars'
                                    }
                                }]
                            },
                            title: {
                                display: true,
                                text: 'Number of cars parked today hourly',
                                fontSize: 16
                            },
                            legend: {
                                display: false
                            }
                        }
                    })
                },
                async fetchData() {

                    this.loading = true
                    this.error = ''

                    this.clearChartData(this.cars_parked_hourly_chart)

                    try {

                        const response = await axios.get('https://smartrooms.ddns.net/api/g4/main_data_package')

                        this.average_number_of_cars_parked_today = response.data["Average number of cars parked today"]
                        this.average_number_of_free_spaces_today = response.data["Average number of free spaces today"]
                        this.busiest_hours_today = response.data["Busiest hours today"]
                        this.number_of_cars_parked = response.data["Number of cars parked"]
                        this.number_of_cars_parked_today_hourly = response.data["Number of cars parked today hourly"]
                        this.number_of_entries_in_the_last_hour = response.data["Number of entries in the last hour"]
                        this.number_of_entries_today = response.data["Number of entries today"]
                        this.number_of_exits_in_the_last_hour = response.data["Number of exits in the last hour"]
                        this.number_of_exits_today = response.data["Number of exits today"]
                        this.number_of_free_spaces = response.data["Number of free spaces"]
                        this.number_of_spaces = response.data["Number of spaces"]

                    } catch (e) {
                        this.loading = false
                        this.error = e.message
                        return
                    }

                    // Cars Parked Hourly Chart
                    this.cars_parked_hourly_chart.data = {
                        labels: this.number_of_cars_parked_today_hourly.map((c, i) => i),
                        datasets: [{
                            data: this.number_of_cars_parked_today_hourly.map((c, i) => c),
                            backgroundColor: 'grey'
                        }]
                    }
                    this.cars_parked_hourly_chart.update()

                    // loading false
                    this.loading = false

                }
            },
            mounted: function () {
                this.initCharts()
                this.fetchData()
            }
        })


    </script>
</body>

</html>